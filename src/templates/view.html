{% extends "base.html" %}
{% block content %}

<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<div>
    {% if not bookmarked %}
    <a id="bookmark" class="is-size-7" style="display:inline;" href="{{ url_for('bookmrk.bookmark', docid=docid) }}">
        <img id="bkmrk" width="10" src="{{ url_for('static',filename='images/bookmark-gray.png') }}">
    </a>
    {% endif %}
    {% if bookmarked %}
    <a id="bookmark" class="is-size-7" style="display:inline;" href="{{ url_for('bookmrk.bookmark', docid=docid) }}">
        <img id="bkmrk" width="10" src="{{ url_for('static',filename='images/bookmark-red.png') }}">
    </a>
    {% endif %}

    <h1 id="name" class="title is-4" style="margin-bottom:0em; display:inline;"></h1>
    {% if "draft" == document[2] %} <br><span class="draft">DRAFT</span> {% endif%}
    <div style="margin-left:20px; margin-top:10px; float:right; width:330px;">
        <div class="widget">
            <h4 id="name" class="title is-6" style="margin-bottom:0em;">Recommendations</h4>
            {% if suggestlist is not none %}
                {% for key, name in suggestlist %}
                <a style="display:block;" class="is-size-6" href="{{ url_for('app.view',id=key) }}">
                    {{name}}
                </a>
                {% endfor %}
            {% else %}
                <p class="is-size-7">creating recommendations...</p>
            {% endif %}
        </div>
        {% if current_user.is_editor() %}
        <div class="widget">
            <h4 id="name" class="title is-6" style="margin-bottom:0em;">Actions</h4>
            <p>
                <a class="is-size-6" style="display:inline;" href="{{ url_for('app.edit',id=docid) }}">Edit</a>
            </p>
        </div>
        {% endif %}
    </div>
    <div id="editor" style="text-align:justify; text-justify: inter-word; margin-right:370px;"></div>
</div>

<script>
    $("#bookmark").click(function(event){
        event.preventDefault();
        $.ajax({
	        type: "POST",
	        url: "{{ url_for('bookmrk.bookmark')}}",
	        data : {docid:"{{docid}}"},
	        success: function(data) {
	        console.log(data);
            $.notify(data["message"], "success");
            if (data["hasbookmark"]){$('#bkmrk').attr('src', "{{ url_for('static',filename='images/bookmark-red.png') }}");}
            if (!data["hasbookmark"]){$('#bkmrk').attr('src', "{{ url_for('static',filename='images/bookmark-gray.png') }}");}
	        }});
        return false; 
    });

    $( "#name" ).text(decodeURIComponent("{{document[0]}}"));  
      const viewer = toastui.Editor.factory({
        el: document.querySelector('#editor'),
        viewer: true,
        height: '500px',
        linkAttributes: {
            target: '_blank',
            contenteditable: 'false',
            rel: 'noopener noreferrer'
        },
        initialValue: decodeURIComponent("{{document[1]}}")
        });

    $("#delete").click(function() {
        if (confirm("Confirm the deletion of the document!") == true) {
            return true;
        } else {
            return false;
    }})

</script>
{% endblock %}
